<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Gebrauchtwagenhändler Tycoon</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f4f4f4;
        }
        #statusbar {
            background: #222;
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
        }
        #main {
            display: flex;
            padding: 10px;
        }
        #vehicle-list, #owned-vehicles {
            width: 50%;
            padding: 10px;
        }
        .vehicle {
            background: white;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
        }
        .bar-container {
            background: #ddd;
            height: 20px;
            width: 100%;
            margin: 5px 0;
        }
        .bar {
            height: 100%;
            background: green;
        }
        .button {
            margin-top: 10px;
            padding: 5px 10px;
            cursor: pointer;
        }
        #designer, #sell-panel {
            padding: 10px;
            background: #fff;
            margin-top: 10px;
        }
        #sell-price {
            width: 100%;
        }
    </style>
</head>
<body>

<div id="statusbar">
    <div>Kontostand: <span id="money">10000</span> €</div>
    <div>Fahrzeuge im Bestand: <span id="inventory-count">0</span></div>
</div>

<div id="main">
    <div id="vehicle-list">
        <h2>Fahrzeuge zum Kauf</h2>
        <div id="market"></div>
    </div>
    <div id="owned-vehicles">
        <h2>Eigene Fahrzeuge</h2>
        <div id="inventory"></div>
    </div>
</div>

<div id="designer" style="display:none;"></div>
<div id="sell-panel" style="display:none;">
    <h3>Fahrzeug inserieren</h3>
    <p>Gesamtkosten: <span id="total-cost"></span> €</p>
    <label>Verkaufspreis: <input type="range" id="sell-price" min="1000" max="20000" value="10000" oninput="updateSellPreview()"></label>
    <p>Gewinn: <span id="profit-preview">0</span> €</p>
    <button onclick="confirmSale()">Inserieren</button>
</div>

<script>
    let money = 10000;
    let inventory = [];

    function updateStatus() {
        document.getElementById('money').innerText = money;
        document.getElementById('inventory-count').innerText = inventory.length;
    }

    function randomVehicle() {
        const makes = ['AutoStar', 'SpeedLine', 'RetroMotors'];
        const models = ['Falcon', 'Storm', 'Nova', 'Urban', 'Classic'];
        return {
            id: Date.now() + Math.random(),
            make: makes[Math.floor(Math.random() * makes.length)],
            model: models[Math.floor(Math.random() * models.length)],
            opt: Math.floor(Math.random() * 100),
            tech: Math.floor(Math.random() * 100),
            repairCost: Math.floor(Math.random() * 2000) + 500,
            basePrice: Math.floor(Math.random() * 3000) + 1000
        };
    }

    function renderBar(value) {
        return `<div class="bar-container"><div class="bar" style="width:${value}%;background:${value > 66 ? 'green' : value > 33 ? 'orange' : 'red'};"></div></div>`;
    }

    function renderMarket() {
        const market = document.getElementById('market');
        market.innerHTML = '';
        for (let i = 0; i < 3; i++) {
            const v = randomVehicle();
            const div = document.createElement('div');
            div.className = 'vehicle';
            div.innerHTML = `
                <strong>${v.make} ${v.model}</strong><br>
                Optischer Zustand:${renderBar(v.opt)}<br>
                Technischer Zustand:${renderBar(v.tech)}<br>
                Geschätzte Reparaturkosten: ${v.repairCost} €<br>
                Kaufpreis: ${v.basePrice} €<br>
                <button class="button" onclick='buyVehicle(${JSON.stringify(v)})'>Kaufen</button>
            `;
            market.appendChild(div);
        }
    }

    function buyVehicle(v) {
        if (money < v.basePrice) return alert("Nicht genug Geld!");
        money -= v.basePrice;
        v.totalInvested = v.basePrice;
        v.repaired = false;
        v.upgraded = false;
        inventory.push(v);
        renderInventory();
        updateStatus();
    }

    function renderInventory() {
        const inv = document.getElementById('inventory');
        inv.innerHTML = '';
        inventory.forEach((v, i) => {
            const div = document.createElement('div');
            div.className = 'vehicle';
            div.innerHTML = `
                <strong>${v.make} ${v.model}</strong><br>
                Optischer Zustand:${renderBar(v.opt)}<br>
                Technischer Zustand:${renderBar(v.tech)}<br>
                <button class="button" onclick='repair(${i})'>Technisch reparieren (500 €)</button>
                <button class="button" onclick='upgrade(${i})'>Optisch aufwerten (500 €)</button>
                <button class="button" onclick='prepareSell(${i})'>Inserieren</button>
            `;
            inv.appendChild(div);
        });
    }

    function repair(i) {
        if (money < 500) return alert("Nicht genug Geld!");
        if (inventory[i].tech >= 100) return;
        inventory[i].tech = 100;
        inventory[i].totalInvested += 500;
        money -= 500;
        renderInventory();
        updateStatus();
    }

    function upgrade(i) {
        if (money < 500) return alert("Nicht genug Geld!");
        if (inventory[i].opt >= 100) return;
        inventory[i].opt = 100;
        inventory[i].totalInvested += 500;
        money -= 500;
        renderInventory();
        updateStatus();
    }

    let currentSellIndex = null;

    function prepareSell(i) {
        currentSellIndex = i;
        document.getElementById('designer').style.display = 'none';
        const v = inventory[i];
        document.getElementById('sell-panel').style.display = 'block';
        document.getElementById('sell-price').value = v.totalInvested + 2000;
        document.getElementById('total-cost').innerText = v.totalInvested;
        updateSellPreview();
    }

    function updateSellPreview() {
        const price = parseInt(document.getElementById('sell-price').value);
        const cost = inventory[currentSellIndex].totalInvested;
        document.getElementById('profit-preview').innerText = price - cost;
    }

    function confirmSale() {
        const v = inventory[currentSellIndex];
        const price = parseInt(document.getElementById('sell-price').value);
        document.getElementById('sell-panel').style.display = 'none';
        setTimeout(() => {
            money += price;
            inventory.splice(currentSellIndex, 1);
            renderInventory();
            updateStatus();
            alert(`Auto verkauft für ${price} €!`);
        }, Math.random() * 5000 + 2000); // Verkauf nach 2–7 Sekunden
    }

    renderMarket();
    updateStatus();
    setInterval(renderMarket, 30000); // Neue Fahrzeuge alle 30 Sek
</script>

</body>
</html>
